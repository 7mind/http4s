<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <title>http4s: Coding Standard</title>

  <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" >  
  <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css" >  
  <link rel="stylesheet" type="text/css" href="/css/fontello.css" >
  <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Share+Tech+Mono" >
  <link rel="stylesheet" type="text/css" href="/css/highlight-github.css">
  <link rel="stylesheet" type="text/css" href="/css/style.css" >
</head>

  <body>
    <nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">
	<img src="/images/http4s-logo.svg" alt="logo" class="logo" /> http4s
      </a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
	
	
	  <li >
	    <a href="/community/">Community</a>
	  </li>
	
	  <li class="active">
	    <a href="/standards/">Coding Standard</a>
	  </li>
	
	  <li >
	    <a href="/adopters/">Adopters</a>
	  </li>
	
	<li class="dropdown">
  <a class="dropdown-toggle" id="doc-menu-item" data-toggle="dropdown" data-target="#" href="http://http4s.org/" role="button" aria-haspopup="true" aria-expanded="false">
    Documentation <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" aria-labelledby="doc-menu-item">
    <li><a href="/versions/">Versions</a></li>
    
    <li role="separator" class="divider"></li>
    <li class="dropdown-header">v0.18 (development)</li>
    <li><a href="/v0.18/">Tutorial</a></li>
    <li><a href="/v0.18/api/org/http4s/">Scaladoc</a></li>
    
    <li role="separator" class="divider"></li>
    <li class="dropdown-header">v0.17</li>
    <li><a href="/v0.17/">Tutorial</a></li>
    <li><a href="/v0.17/api/org/http4s/">Scaladoc</a></li>
    
    <li role="separator" class="divider"></li>
    <li class="dropdown-header">v0.16</li>
    <li><a href="/v0.16/">Tutorial</a></li>
    <li><a href="/v0.16/api/org/http4s/">Scaladoc</a></li>
    
    <li role="separator" class="divider"></li>
    <li class="dropdown-header">v0.15 (eol)</li>
    <li><a href="/v0.15/">Tutorial</a></li>
    <li><a href="/v0.15/api/org/http4s">Scaladoc</a></li>
  </ul>
</li>

      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="https://github.com/http4s/http4s" title="http4s/http4s on GitHub"><span class="icon-github-circled"></span></a></li>	
        <li><a href="https://gitter.im/http4s/http4s" title="http4s/http4s on Gitter"><span class="icon-gitter" aria-hidden="true"></span></a></li>
        <li><a href="https://twitter.com/http4s" title="@http4s on Twitter"><span class="icon-twitter" aria-hidden="true"></span></a></li>
      </ul>
    </div>
  </div>
</nav>

    <div class="container">
      <div class="content">
	<div class="page-header">
	  <h1>Coding Standard</h1>
	</div>
	

<h2 id="types">Types</h2>

<h3 id="effects">Effects</h3>

<p>Prefer a parameterized effect type and cats-effect type classes over
specializing on a task. (In versions before cats-effect is on the classpath,
specialize on use <code>fs2.Task</code> or <code>scalaz.concurrent.Task</code>.)</p>

<pre><code class="language-scala">// Good
def apply[F[_]](service: HttpService[F])(implicit F: Monad[F]): HttpService[F]

// Bad
def apply(service: HttpService[Task]): HttpService[Task]
</code></pre>

<p>For examples and tutorials, use <code>cats.effect.IO</code> wherever a concrete effect is
needed.</p>

<h3 id="collections">Collections</h3>

<p>Prefer standard library types such as <code>Option</code> and <code>List</code> to invariant
replacements from libraries such as Scalaz or Dogs.</p>

<p>When a list must not be empty, use <code>cats.data.NonEmptyList</code>.</p>

<h3 id="caseinsensitivestring"><code>CaseInsensitiveString</code>`</h3>

<p>Many parts of the HTTP spec require case-insensitive semantics. Use
<code>org.http4s.util.CaseInsensitiveString</code> to represent these. This is important to
get correct matching semantics when using case class extractors.</p>

<h2 id="case-classes">Case classes</h2>

<h3 id="apply"><code>apply</code></h3>

<p>The <code>apply</code> method of a case class companion should be total. If this is
impossible for the product type, create a <code>sealed abstract class</code> and define
alternate constructors in the companion object. Make the implementation of the
sealed abstract class private.</p>

<p>Consider a macro for the <code>apply</code> method if it is partial, but literal arguments
can be validated at compile time.</p>

<h3 id="safe-constructors">Safe constructors</h3>

<p>Constructors that take an alternate type <code>A</code> should be named <code>fromA</code>. This
includes constructors that return a value as a <code>ParseResult</code>.</p>

<pre><code class="language-scala">case class Foo(seconds: Long)

object Foo {
  def fromFiniteDuration(d: FiniteDuration): Foo =
    apply(d.toSeconds)
    
  def fromString(s: String): ParseResult[Foo] =
    try s.toLong
    catch { case e: NumberFormatException =&gt; 
      new ParseFailure(&quot;not a long&quot;) 
    }
}
</code></pre>

<p>Prefer <code>fromString</code> to <code>parse</code>.</p>

<h3 id="unsafe-constructors">Unsafe constructors</h3>

<p>All constructors that are partial on their input should be prefixed with <code>unsafe</code>.</p>

<pre><code>// Good
def fromLong(l: Long): ParseResult[Foo] =
  if (l &lt; 0) Left(ParseFailure(&quot;l must be non-negative&quot;))
  else Right(new Foo(l))
def unsafeFromLong(l: Long): Foo = 
  fromLong(l).fold(throw _, identity)

// Bad
def fromLong(l: Long): ParseResult[Foo] =
  if (l &lt; 0) throw new ParseFailure(&quot;crash boom bang&quot;)
  else Right(new Foo(l))
</code></pre>

<p>Constructors prefixed with <code>from</code> may return either a <code>ParseResult[A]</code> or, if
total, <code>A</code>.</p>

<h2 id="tests">Tests</h2>

<p>We use Specs2 for example-based testing and its integration with scalacheck for
property testing.  Property tests and arbitrary instances are encouraged.</p>

      </div>
    </div>
    <footer>
      <div class="container">
	<nav>
	  <ul class="pager">
	    <li><a href="https://github.com/http4s/http4s/edit/master/docs/src/hugo/content/standards.md"><i class="fa fa-pencil"></i> Edit this page</a></li>
	  </ul>
	</nav>
      </div>
    </footer>
    
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

<script src="/js/bootstrap.min.js"></script>    
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>
